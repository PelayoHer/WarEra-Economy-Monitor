import{$a as M,D as w,a as k,ab as W,b as C,c as Z,e as N,g as O,i as B,k as T,m as U,p as $,q as J,s as I,tb as G,ub as ee,v as D,wb as te,xb as V,yb as q,zb as z}from"./chunk-PEQEZPS6.js";var F=class F{constructor(){this.toastState=w({message:"",type:"success",visible:!1});this.state=this.toastState.asReadonly()}show(e,t="success",s=3e3){clearTimeout(this.timeoutId),this.toastState.set({message:e,type:t,visible:!0}),this.timeoutId=setTimeout(()=>{this.hide()},s)}hide(){this.toastState.update(e=>C(k({},e),{visible:!1}))}};F.\u0275fac=function(t){return new(t||F)},F.\u0275prov=I({token:F,factory:F.\u0275fac,providedIn:"root"});var K=F;var x=class x{constructor(){this.gameDataService=D(G);this.storageService=D(ee);this.characterStateService=D(q);this.marketDataService=D(V);this.marketPriceService=D(z);this.userDataService=D(te);this.toastService=D(K);this.KEYS={COMPANIES:"warera-economic-companies",GLOBAL_BONUS:"warera-global-bonus"};this.economicCompanies=w([]);this.globalProductionBonus=w(0);this.isImportingCompany=w(!1);this.maxTotalEmployees=M(()=>this.characterStateService.statsFromSkills().management??0);this.currentTotalEmployees=M(()=>this.economicCompanies().reduce((e,t)=>e+t.employees.length,0));this.productRecipes=this.gameDataService.getProductRecipes(),this.loadStateFromStorage(),W(()=>this.storageService.setItem(this.KEYS.COMPANIES,this.economicCompanies())),W(()=>this.storageService.setItem(this.KEYS.GLOBAL_BONUS,this.globalProductionBonus()))}loadStateFromStorage(){let e=this.storageService.getItem(this.KEYS.COMPANIES);if(e&&Array.isArray(e)){let s=e.map(i=>{let o=i,{breakRoomLevel:c}=o,n=Z(o,["breakRoomLevel"]),r=i.employees&&Array.isArray(i.employees)?i.employees.map(a=>C(k({},a),{fidelity:a.fidelity??a.loyaltyPct??0})):[];return C(k({},n),{storageLevel:i.storageLevel??1,employees:r,currentProduction:i.currentProduction??0})});this.economicCompanies.set(s)}else this.economicCompanies.set([{id:crypto.randomUUID(),productName:null,level:1,productionBonus:0,storageLevel:1,employees:[],currentProduction:0}]);let t=this.storageService.getItem(this.KEYS.GLOBAL_BONUS);typeof t=="number"&&this.globalProductionBonus.set(t)}createCompany(){if(this.economicCompanies().length<12){let e={id:crypto.randomUUID(),productName:null,level:1,productionBonus:0,storageLevel:1,employees:[],currentProduction:0};this.economicCompanies.update(t=>[...t,e])}else this.toastService.show("You have reached the maximum of 12 companies.","error")}deleteCompany(e){this.economicCompanies.update(t=>t.filter(s=>s.id!==e))}updateCompanyLevel(e,t){this.economicCompanies.update(s=>s.map(i=>i.id===e?C(k({},i),{level:t}):i))}assignProductToCompany(e,t){this.economicCompanies.update(s=>s.map(i=>i.id===e?C(k({},i),{productName:t}):i))}updateCompanyProductionBonus(e,t){this.economicCompanies.update(s=>s.map(i=>i.id===e?C(k({},i),{productionBonus:t}):i))}setAllCompanyProductionBonuses(e){this.economicCompanies.update(t=>t.map(s=>C(k({},s),{productionBonus:e})))}updateCompanyStorageLevel(e,t){this.economicCompanies.update(s=>s.map(i=>i.id===e?C(k({},i),{storageLevel:t}):i))}addManualWorker(e,t,s,i,c=0){if(!this.economicCompanies().find(m=>m.id===e))return;let r=s*i*.24,o=r*(1+c/100),u={id:`manual-${Date.now()}-${Math.random().toString(36).substr(2,5)}`,username:`Worker (${s}E/${i}P)`,dailyProduction:r,effectiveProduction:o,fidelity:c,wage:t,stats:{energy:s,production:i},isReal:!1};this.economicCompanies.update(m=>m.map(d=>d.id===e?C(k({},d),{employees:[...d.employees,u]}):d)),this.toastService.show("Added worker!","success")}removeWorkerFromCompany(e,t){this.economicCompanies.update(s=>s.map(i=>i.id===e?C(k({},i),{employees:i.employees.filter(c=>c.id!==t)}):i))}moveWorker(e,t,s){let i=this.economicCompanies(),c=i.find(o=>o.id===e);if(!c)return;let n=c.employees.find(o=>o.id===s);if(!n)return;let r=i.find(o=>o.id===t);!r||e===t||(this.economicCompanies.update(o=>o.map(a=>a.id===e?C(k({},a),{employees:a.employees.filter(u=>u.id!==s)}):a.id===t?C(k({},a),{employees:[...a.employees,n]}):a)),this.toastService.show(`Moved worker to ${r.name||"another company"}.`,"success"))}optimizeEmployeeDistribution(){let e=this.economicCompanies();if(e.length===0){this.toastService.show("No companies to optimize.","info");return}let t=this.marketPriceService.allProductsProfitability(),s=new Map;t.forEach(o=>s.set(o.productName,o.profitPerPP));let i=[];if(e.forEach(o=>{o.employees.forEach(a=>{i.push({employee:a,originalCompanyId:o.id})})}),i.length===0){this.toastService.show("No employees to distribute.","info");return}let c=e.map(o=>{let a=o.productName?s.get(o.productName)??0:0,u=1+o.productionBonus/100;return{id:o.id,factor:a*u,productName:o.productName}}),n=new Map;e.forEach(o=>n.set(o.id,[]));let r=0;i.forEach(({employee:o,originalCompanyId:a})=>{let u=a,m=c.find(l=>l.id===a),d=-1/0;if(m&&m.productName){let l=1+o.fidelity/100;d=m.factor*l-o.wage}c.forEach(l=>{if(l.id===a||!l.productName)return;let p=l.factor*1-o.wage;p>d&&(d=p,u=l.id)});let y=u!==a,h=k({},o);y&&(r++,h.fidelity=0,h.effectiveProduction=h.dailyProduction);let f=n.get(u);f?f.push(h):n.get(a)?.push(o)}),r>0?(this.economicCompanies.update(o=>o.map(a=>C(k({},a),{employees:n.get(a.id)||[]}))),this.toastService.show(`Optimized! Redistributed ${r} employees.`,"success")):this.toastService.show("Workforce is already optimally distributed.","success")}importCompany(e){if(!(!e||e.trim()==="")){if(this.economicCompanies().some(t=>t.id===e)){this.toastService.show("This company is already in your list.","error");return}if(this.economicCompanies().length>=12){this.toastService.show("You have reached the maximum of 12 companies.","error");return}this.isImportingCompany.set(!0),this.marketDataService.fetchCompanyData(e,!0).pipe($(t=>{if(!t)throw new Error("Company not found");return this.fetchFullCompanyDetails(t)}),U(1)).subscribe({next:t=>{this.economicCompanies.update(s=>[...s,t]),this.toastService.show(`Successfully imported company "${t.name}"!`,"success"),this.isImportingCompany.set(!1)},error:t=>{console.error("Failed to import company",t),this.toastService.show("Failed to import company. Please check the ID.","error"),this.isImportingCompany.set(!1)}})}}loadUserCompanies(e){e&&(this.isImportingCompany.set(!0),this.marketDataService.fetchWorkers(e).pipe($(t=>{if(!t||t.length===0)return N([]);let s=t.map(r=>r.company._id),i=new Set;t.forEach(r=>r.workers.forEach(o=>i.add(o.user)));let c=Array.from(i),n=[];return s.forEach(r=>{n.push({procedure:"company.getById",input:{companyId:r}}),n.push({procedure:"upgrade.getUpgradeByTypeAndEntity",input:{companyId:r,upgradeType:"automatedEngine"}}),n.push({procedure:"upgrade.getUpgradeByTypeAndEntity",input:{companyId:r,upgradeType:"storage"}})}),B({mixedData:this.marketDataService.fetchMixedBatch(n),users:this.userDataService.fetchUsersBatch(c),regions:Object.keys(this.marketPriceService.regions()).length>0?N(this.marketPriceService.regions()):this.marketDataService.fetchRegions().pipe(J(r=>this.marketPriceService.regions.set(r))),countries:this.marketPriceService.countries().length>0?N(this.marketPriceService.countries()):this.marketDataService.fetchCountries().pipe(J(r=>this.marketPriceService.countries.set(r)))}).pipe($(({mixedData:r,users:o,regions:a,countries:u})=>{let m=[],d=new Map,y=new Set;for(let f=0;f<r.length;f+=3){let l=r[f],b=r[f+1],p=r[f+2];if(l&&(m.push(l),b&&d.set(`${l._id}-automatedEngine`,b.level),p&&d.set(`${l._id}-storage`,p.level),l.region&&a[l.region])){let v=a[l.region],P=u.find(A=>A._id===v.country);P&&P.rulingParty&&y.add(P.rulingParty)}}return(y.size>0?this.marketDataService.fetchPartiesBatch(Array.from(y)):N([])).pipe(O(f=>{let l=new Map;f.forEach(p=>{p&&l.set(p._id,p)});let b=new Map;return o.forEach(p=>{p&&b.set(p._id,p)}),m.map(p=>{let P=(t.find(S=>S.company._id===p._id)?.workers||[]).map(S=>{let R=b.get(S.user);return R?{userData:R,wage:S.wage,joinedAt:S.joinedAt,fidelity:S.fidelity}:null}).filter(S=>S!==null),A=d.get(`${p._id}-automatedEngine`),E=d.get(`${p._id}-storage`);return this.mapCompanyToEconomicCompany(p,{automatedEngine:A,storage:E},P,a,u,l)})}))}))}),U(1)).subscribe({next:t=>{t.length>0?(this.economicCompanies.set(t),this.toastService.show(`Loaded ${t.length} companies.`,"success")):(this.economicCompanies.set([]),this.toastService.show("No companies found.","info")),this.isImportingCompany.set(!1)},error:t=>{console.error("Failed to load user companies",t),this.toastService.show("Failed to load companies.","error"),this.isImportingCompany.set(!1)}}))}mapCompanyToEconomicCompany(e,t,s,i,c,n){let r=this.marketPriceService.apiToAppNameMapping[e.itemCode],o=t.automatedEngine??1,a=t.storage??1,u=[];s&&s.forEach(p=>{if(p&&p.userData){let v=p.userData,P=v.skills?.energy?.level?30+v.skills.energy.level*10:100,A=v.skills?.production?.level?10+v.skills.production.level*3:10,E=P*A*.24,S=p.fidelity;if(S==null)if(p.joinedAt){let Q=new Date(p.joinedAt).getTime(),oe=Date.now(),se=Math.abs(oe-Q),ne=Math.floor(se/(1e3*60*60*24));S=Math.min(10,Math.max(0,ne))}else S=0;let R=E*(1+S/100);u.push({id:v._id,username:v.username,avatarUrl:v.animatedAvatarUrl||v.avatarUrl,dailyProduction:E,effectiveProduction:R,fidelity:S,wage:p.wage,stats:{energy:P,production:A},isReal:!0,joinedAt:p.joinedAt})}});let m=e.itemCode,d,y,h=0,f=0,l=0;if(e.region&&i[e.region]){let p=i[e.region];if(d=p.name,m&&p.deposit&&p.deposit.type===m){let P=new Date,A=p.deposit.endsAt?new Date(p.deposit.endsAt):null;(!A||A>P)&&(h=p.deposit.bonusPercent??0)}let v=c.find(P=>P._id===p.country);if(v&&(y=v.name,v.specializedItem===m&&(f=v.strategicResources?.bonuses?.productionPercent??0),n&&v.rulingParty)){let P=n.get(v.rulingParty);if(P&&P.ethics){let A=P.ethics.industrialism;A>0?v.specializedItem===m&&(l+=A===2?30:10):A<0&&["coca","grain","livestock","fish"].includes(m)&&p.deposit&&p.deposit.type===m&&(l+=A===-2?30:10)}}}let b=h+f+l;return{id:e._id,name:e.name,productName:r||null,level:Math.max(1,Math.min(7,o)),productionBonus:b,storageLevel:a,currentProduction:e.production||0,employees:u,regionName:d,countryName:y,regionBonusValue:h,countryBonusValue:f}}fetchFullCompanyDetails(e){let t=B({storage:this.marketDataService.fetchCompanyUpgrade(e._id,"storage"),automatedEngine:this.marketDataService.fetchCompanyUpgrade(e._id,"automatedEngine")}),s=e.workers||[],i=s.length>0?B(s.map(r=>this.userDataService.fetchUserData(r.user).pipe(O(o=>({userData:o,wage:r.wage,joinedAt:r.joinedAt,fidelity:r.fidelity})),T(o=>(console.warn(`Failed to fetch user ${r.user}`,o),N(null)))))).pipe(O(r=>r.filter(o=>o!==null))):N([]),c=Object.keys(this.marketPriceService.regions()).length>0?N(this.marketPriceService.regions()):this.marketDataService.fetchRegions().pipe(J(r=>this.marketPriceService.regions.set(r)),T(()=>N({}))),n=this.marketPriceService.countries().length>0?N(this.marketPriceService.countries()):this.marketDataService.fetchCountries().pipe(J(r=>this.marketPriceService.countries.set(r)),T(()=>N([])));return B({upgrades:t,workersDetails:i,regionsMap:c,countriesList:n}).pipe($(({upgrades:r,workersDetails:o,regionsMap:a,countriesList:u})=>{let m=N(void 0);if(e.region&&a[e.region]){let d=a[e.region],y=u.find(h=>h._id===d.country);y&&y.rulingParty&&(m=this.marketDataService.fetchParty(y.rulingParty).pipe(O(h=>h??void 0),T(()=>N(void 0))))}return m.pipe(O(d=>({upgrades:r,workersDetails:o,regionsMap:a,countriesList:u,party:d})))}),O(({upgrades:r,workersDetails:o,regionsMap:a,countriesList:u,party:m})=>{let d=new Map;return m&&d.set(m._id,m),this.mapCompanyToEconomicCompany(e,{automatedEngine:r.automatedEngine?.level,storage:r.storage?.level},o,a,u,d)}))}};x.\u0275fac=function(t){return new(t||x)},x.\u0275prov=I({token:x,factory:x.\u0275fac,providedIn:"root"});var Y=x;var j=class j{constructor(){this.characterStateService=D(q);this.marketPriceService=D(z);this.rawWorkOffers=w([]);this.fetchWorkOffersError=w(null);this.jobSearchProfile=w({energy:100,production:10});this.customJobWage=w(null);this.selectedCountryFilter=w("ALL");this.analyzedJobOffers=M(()=>{let e=this.rawWorkOffers(),t=this.marketPriceService.regions(),s=this.marketPriceService.countries(),i=this.jobSearchProfile(),c=new Map(s.map(n=>[n._id,n]));return e.map(n=>{let r=t[n.region],o="Unknown Region",a="Unknown Country",u=0,m;if(r){o=r.name;let f=c.get(r.country);f&&(a=f.name,u=f.taxes?.income??0)}n.citizenship&&(m=c.get(n.citizenship)?.name);let d=n.wage*(1-u/100),y=!n.minEnergy||i.energy>=n.minEnergy,h=!n.minProduction||i.production>=n.minProduction;return C(k({},n),{regionName:o,countryName:a,taxRate:u,netWage:d,isQualified:y&&h,citizenshipCountryName:m})})});this.topGrossWagesGrouped=M(()=>{let e=this.rawWorkOffers(),t=new Map;for(let s of e){let i=t.get(s.wage)||0;t.set(s.wage,i+1)}return Array.from(t.entries()).sort((s,i)=>i[0]-s[0]).slice(0,5).map(([s,i])=>({wage:s,count:i}))});this.topGlobalNetJobOffers=M(()=>[...this.analyzedJobOffers()].sort((e,t)=>this.sortOffersByNetAndFrance(e,t)).slice(0,5));this.bestPersonalJobOffers=M(()=>{let e=this.selectedCountryFilter(),t=this.characterStateService.userCitizenship(),s=null,i=!1;return e==="ALL"?i=!0:e?s=e:s=t,this.analyzedJobOffers().filter(c=>c.isQualified?i?!0:!c.citizenship||s&&c.citizenship===s:!1).sort((c,n)=>this.sortOffersByNetAndFrance(c,n)).slice(0,5)});this.effectiveMarketWage=M(()=>{let e=this.customJobWage();if(e!==null&&e>0)return e;let t=this.topGrossWagesGrouped();return t.length>0?t[0].wage:0});W(()=>{let e=this.characterStateService.statsFromSkills(),t=e.energy,s=e.production;if(t&&s){let i=this.jobSearchProfile();(i.energy!==t||i.production!==s)&&this.jobSearchProfile.set({energy:t,production:s})}}),W(()=>{let e=this.characterStateService.userCitizenship();e&&this.selectedCountryFilter.set(e)})}sortOffersByNetAndFrance(e,t){let s=t.netWage-e.netWage;if(Math.abs(s)>1e-5)return s;let i=e.countryName==="France",c=t.countryName==="France";return i&&!c?-1:!i&&c?1:0}setCustomJobWage(e){this.customJobWage.set(e)}setSelectedCountryFilter(e){this.selectedCountryFilter.set(e)}setJobSearchProfile(e,t){this.jobSearchProfile.set({energy:e,production:t})}};j.\u0275fac=function(t){return new(t||j)},j.\u0275prov=I({token:j,factory:j.\u0275fac,providedIn:"root"});var _=j;var L=class L{constructor(){this.gameDataService=D(G);this.marketDataService=D(V);this.marketPriceService=D(z);this.companyService=D(Y);this.jobMarketService=D(_);this.tutorialTabRequest=w(null);this.isRefreshing=w(!1);this.isFetchingRegionBonuses=w(!1);this.rawMaterialsRecommendations=w(new Map);this.regionBonuses=M(()=>{let e=this.marketPriceService.marketPrices(),t=this.marketPriceService.regions(),s=this.marketPriceService.countries(),i=this.productRecipes,c=this.rawMaterialsRecommendations();if(Object.keys(t).length===0||s.length===0)return[];let n=new Map(s.map(o=>[o._id,o])),r=[];if(c.size>0)for(let[o,a]of c.entries()){let u=i[o],m=e[o]??0;if(!(!o||!u||m===0))for(let d of a){let y=t[d.regionId];if(y){if(d.depositEndAt){let h=new Date;if(new Date(d.depositEndAt).getTime()<=h.getTime())continue}r.push({regionName:y.name,productName:o,bonus:d.bonus,endsAt:d.depositEndAt||""})}}}else{let o=new Date;for(let a in t){let u=t[a];if(!u.deposit?.type||!u.deposit.endsAt)continue;let m=this.capitalize(u.deposit.type);if(!i[m]||(e[m]??0)===0||new Date(u.deposit.endsAt).getTime()<=o.getTime())continue;let f=n.get(u.country),l=u.deposit.bonusPercent??0,b=0;f&&f.specializedItem===u.deposit.type&&(b=f.strategicResources?.bonuses?.productionPercent??0),r.push({regionName:u.name,productName:m,bonus:l+b,endsAt:u.deposit.endsAt})}}return r});this.regionBonusSuggestions=M(()=>{let e=this.companyService.economicCompanies().filter(r=>r.productName),t=this.regionBonuses(),s=this.marketPriceService.marketPrices(),i=this.productRecipes,c=s.Concrete??0,n=[];for(let r of e){if(!r.productName)continue;let o=t.filter(a=>a.productName===r.productName).sort((a,u)=>u.bonus-a.bonus)[0];if(o&&o.bonus>(r.productionBonus??0)){let a=r.productionBonus??0,u=o.bonus,m=(u-a)/100,d=r.level*24,y=r.employees.reduce((p,v)=>p+v.effectiveProduction,0),h=d+y,f=i[r.productName],l=s[r.productName]??0,b=0;if(f&&l>0&&h>0){let p=f.ppCost||1;b=h/p*f.outputQuantity*m*l}n.push({companyId:r.id,companyName:r.name||"Unnamed Company",productName:r.productName,currentBonus:a,suggestedRegion:o.regionName,suggestedBonus:u,suggestedRegionEndTime:o.endsAt,potentialDailyProfitIncrease:b,relocationCost:5*c})}}return n.sort((r,o)=>o.potentialDailyProfitIncrease-r.potentialDailyProfitIncrease)});this.productValueRanks=M(()=>{let e=this.marketPriceService.marketPrices(),t=this.productRecipes;return[...this.gameDataService.getProducts().raw,...this.gameDataService.getProducts().manufacturing].map(i=>this.calculateProductValue(i,e,t)).filter(i=>i.price>0).sort((i,c)=>c.value-i.value)});this.highestProductValue=M(()=>{let e=this.productValueRanks();return e.length>0?e[0].value:0});this.manufacturingProfitability=M(()=>{let e=this.marketPriceService.marketPrices(),t=this.productRecipes,s=this.gameDataService.getProducts().manufacturing,i=this.jobMarketService.effectiveMarketWage(),c=new Map;for(let n of s){let r=t[n],o=e[n]??0;if(!r||o===0){c.set(n,{craftCost:0,netMargin:0,isProfitable:!1});continue}let a=0,u=!1;for(let f of r.inputs){let l=e[f.name]??0;l===0&&(u=!0),a+=l*f.quantity}let m=r.ppCost*i,y=(a+m)/r.outputQuantity,h=o-y;c.set(n,{craftCost:y,netMargin:h,isProfitable:h>0&&!u})}return c});this.rawMaterialDemandAnalysis=M(()=>{let e=this.marketPriceService.productTopBuyPrices(),t=this.marketPriceService.marketPrices(),s=this.gameDataService.getProducts().raw,i=new Map;for(let c of s){let n=e.get(c)??0,r=t[c]??0;if(n>0&&r>0){let o=(r-n)/r;i.set(c,{isHighDemand:o<.15,spreadPercent:o*100})}}return i});this.productRecipes=this.gameDataService.getProductRecipes(),this.loadStaticData(),this.refreshDynamicData(!0)}loadStaticData(){this.isFetchingRegionBonuses.set(!0),B({regions:this.marketDataService.fetchRegions(),countries:this.marketDataService.fetchCountries()}).pipe(U(1)).subscribe({next:({regions:e,countries:t})=>{this.marketPriceService.regions.set(e),this.marketPriceService.countries.set(t),this.isFetchingRegionBonuses.set(!1)},error:e=>{console.error("Failed to fetch static economic data:",e),this.isFetchingRegionBonuses.set(!1),this.jobMarketService.fetchWorkOffersError.set("Failed to load region/country data.")}})}refreshDynamicData(e=!1){this.isRefreshing.set(!0),this.jobMarketService.fetchWorkOffersError.set(null);let t=[...this.gameDataService.getProducts().raw,...this.gameDataService.getProducts().manufacturing],s=this.marketPriceService.appToApiNameMapping(),i=t.map(r=>s[r]).filter(r=>!!r),c=[];i.forEach(r=>{c.push({procedure:"tradingOrder.getTopOrders",input:{itemCode:r,limit:100}}),c.push({procedure:"transaction.getPaginatedTransactions",input:{itemCode:r,limit:100}})}),i.forEach(r=>{c.push({procedure:"company.getRecommendedRegionIdsByItemCode",input:{itemCode:r}})});let n=this.marketDataService.fetchMixedBatch(c).pipe(T(()=>N([])));B({prices:this.marketDataService.fetchPrices(e),workOffers:this.marketDataService.fetchWorkOffers(e),batchResults:n}).pipe(U(1)).subscribe({next:({prices:r,workOffers:o,batchResults:a})=>{let u={};for(let f in r){let l=this.marketPriceService.apiToAppNameMapping[f];l&&(u[l]=r[f])}this.marketPriceService.marketPrices.set(u),this.marketPriceService.updateGoldCosts(u);let m=new Map,d=new Map,y=new Map,h=0;i.forEach(f=>{let l=a[h++],b=a[h++],p=this.marketPriceService.apiToAppNameMapping[f],v=l?.buyOrders?.[0]?.price??0;v>0&&m.set(p,v);let P=Date.now()-1440*60*1e3,E=(b?.items||[]).reduce((S,R)=>{let Q=R.createdAt?new Date(R.createdAt).getTime():Date.now();return R.createdAt&&Q<P?S:S+R.quantity},0);d.set(p,E)}),i.forEach(f=>{let l=a[h++],b=this.marketPriceService.apiToAppNameMapping[f];b&&y.set(b,l||[])}),this.marketPriceService.updateTopBuyOrders(m),this.marketPriceService.productMarketVolume.set(d),this.rawMaterialsRecommendations.set(y),this.jobMarketService.rawWorkOffers.set(o),this.isRefreshing.set(!1)},error:r=>{console.error("Failed to fetch dynamic economic data:",r),this.isRefreshing.set(!1),this.jobMarketService.fetchWorkOffersError.set("Failed to fetch market data.")}})}capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}calculateProductValue(e,t,s){let i=t[e]??0,c=s[e];if(!c)return{productName:e,value:0,price:i,ppCost:0};let n=c.ppCost,r=0;if(c.category==="manufacturing"&&c.inputs.length>0){if(c.inputs.every(a=>(t[a.name]??0)>0)){let a=c.inputs.reduce((m,d)=>m+d.quantity*(t[d.name]??0),0),u=i*c.outputQuantity-a;r=n>0?u/n:0}}else r=n>0?i*c.outputQuantity/n:0;return{productName:e,value:r,price:i,ppCost:n}}};L.\u0275fac=function(t){return new(t||L)},L.\u0275prov=I({token:L,factory:L.\u0275fac,providedIn:"root"});var re=L;function ie(g){return g==="Infinite"?"Infinite":g==="N/A"?"N/A":typeof g!="number"||isNaN(g)?"0.000":Math.abs(g)<1e3?g.toFixed(3):Math.abs(g)<1e6?(g/1e3).toFixed(2)+"K":Math.abs(g)<1e9?(g/1e6).toFixed(2)+"M":(g/1e9).toFixed(2)+"B"}function Ue(g,e){let t=ie(g),s=ie(e);return t===s?t:`${t} - ${s}`}function We(g){if(!g)return"";let e={"Mysterious Plant":"coca",Pill:"cocain",Case:"case1",Steel:"steel.png?v=31"};if(e[g])return e[g].includes(".")?`https://app.warera.io/images/items/${e[g]}`:`https://app.warera.io/images/items/${e[g]}.png`;let t=g.toLowerCase(),s=["helmet","chest","pants","boots","gloves"];for(let n of s)if(t.includes(n))return`https://app.warera.io/images/items/${n}.png`;let i=g.split(/[\s-]+/);return i.length===1?`https://app.warera.io/images/items/${i[0].toLowerCase()}.png`:`https://app.warera.io/images/items/${i.map((n,r)=>r===0?n.toLowerCase():n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()).join("")}.png`}var X={Grain:"fa-solid fa-wheat-awn",Limestone:"fa-solid fa-mountain",Lead:"fa-solid fa-cube",Petroleum:"fa-solid fa-oil-well","Mysterious Plant":"fa-solid fa-leaf",Iron:"fa-solid fa-gem",Livestock:"fa-solid fa-cow",Fish:"fa-solid fa-fish-fins",default:"fa-solid fa-question-circle"};function ze(g){return g&&X[g]||X.default}function $e(g){return g&&g.startsWith("<")}function Je(g){return g===void 0?"text-gray-400":g>0?"text-green-500":g<0?"text-red-500":"text-gray-400"}export{ie as a,Ue as b,We as c,ze as d,$e as e,Je as f,K as g,Y as h,_ as i,re as j};
